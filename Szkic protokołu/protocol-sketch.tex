\documentclass[10pt,titlepage]{article}
\usepackage{graphicx}
\usepackage{graphics}
\usepackage{epsfig}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{booktabs}
\usepackage{url}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage[figuresright]{rotating}
\usepackage[cp1250]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{pslatex}
\usepackage{ulem}
\usepackage{lipsum}
\usepackage{listings}
\usepackage{url}
\usepackage{color}
\usepackage[left=3cm,top=3cm,right=3cm]{geometry} 
\usepackage{bchart}
\usepackage{datapie}
\usepackage{calc}
\usepackage{ifthen}
\usepackage{tikz}
\usepackage{hyperref}
 \usepackage{array,multirow}
 \usepackage{xcolor,colortbl}

\definecolor{light-gray}{gray}{0.95}

\setlength{\textwidth}{400pt}
\lstset{numbers=left,
			numberstyle=\tiny, 
			basicstyle=\scriptsize\ttfamily, 
			breaklines=true, 
			captionpos=b, 
			tabsize=2}

\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\TAB}{\hspace{0.50cm}}
\newcommand{\IFF}{\leftrightarrow}
\newcommand{\IMP}{\rightarrow}
\newcommand{\slice}[4]{
  \pgfmathparse{0.5*#1+0.5*#2}
  \let\midangle\pgfmathresult

  % slice
  \draw[thick,fill=black!10] (0,0) -- (#1:1) arc (#1:#2:1) -- cycle;

  % outer label
  \node[label=\midangle:#4] at (\midangle:1) {};

  % inner label
  \pgfmathparse{min((#2-#1-10)/110*(-0.3),0)}
  \let\temp\pgfmathresult
  \pgfmathparse{max(\temp,-0.5) + 0.8}
  \let\innerpos\pgfmathresult
  \node at (\midangle:\innerpos) {#3};
}
\makeindex






\begin{document}

\section*{Simple but longterm card-terminal authorization protocol based on one time passwords - sketch of protocol}

\subsubsection*{Prerequisites}

\begin{itemize}
	\item  Each card has a unique id and stores its current state (ST), which is simultaneously a symmetric key used for secure communication with the terminal.
	\item Terminal stores a mapping from card ids to their current states. We assume that for a given card, the initial
\end{itemize}

\subsubsection*{Definitions}

\begin{itemize}
	\item $Card_{ID}$  - card IDs space $\{0,1\}^{32}$
	\item R   - challenges space $\{0,1\}^{64}$
	\item K   - key space $\{0,1\}^{256}$ 
	\item Enc - encryption (AES)
	\item Dec - decryption (AES)
	\item ACRT - acceptable card response time (exact value to be defined)
	\item $time()$ - function that returns current timestamp
	\item f : $Card_{ID}  \rightarrow $ K - mapping from card ids to their current states
\end{itemize}

Authentication protocol (simple pre-shared key challenge-response authentication):
 \begin{table}[!ht]
 \centering
	\begin{tabular}{| p{6.55cm}   p{2.55cm}  p{4.55cm}| }
 \hline
 Terminal & Transmission  & Card \\\hline
 1. Has f & & Has ST\\
 &  $\leftarrow Card_{ID}$  & \\
 2. Take $ r \in R $ uniformly at random. &&\\ 
Let $t := time()$ &  &  \\ 
 & $\rightarrow R$ &  \\ 
 3.& &$m_1 := Enc_{ST} (r)$ \\
 &  $\leftarrow m_1$  & \\
4. Let $t' := time()$. &&\\
Check if $t' - t < ACRT$ (If not, abort.) &&\\
&&\\
Let $k := f(Card_{ID})$ and check &&\\ 
if $Dec_K(m_1) = r$ (If not, abort.)&&\\
&&\\
Take $k' \in K \backslash \{k\} $ uniformly at random &&\\
and update $f$ so that $f(Card_{ID}) = k'$.&&\\
&&\\
$m_2 := Enc_{k}(k')$& & \\
 & $\rightarrow m_2$ &  \\ 
5. & & $ ST := Dec_{ST} (m_2)$ \\
 \hline

 \end{tabular}
 \end{table}
 
If the protocol is executed successfully, terminal opens the door to the secure location.
 

\section*{ASN.1 Documentation}

CardProtocol DEFINITIONS ::= BEGIN

    CardHello ::= SEQUENCE \{\\
        cardId       BIT STRING\\
   \}\\

    RandomChallenge ::= SEQUENCE {
        challenge    BIT STRING
    }

    StageOne ::= SEQUENCE {
        oldState     BIT STRING
    }

    StageTwo ::= SEQUENCE {
        newState     BIT STRING
    }

END

\end{document}